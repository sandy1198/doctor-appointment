<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-title>Book an Appointment</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- <ion-header collapse="condense">
    <ion-toolbar color="primary">
      <ion-title size="large">Book an Appointment</ion-title>
    </ion-toolbar>
  </ion-header> -->

  <div class="book-container">
    <ion-list class="book-form-list">
      <ion-item>
        <ion-label position="stacked">District</ion-label>
        <ion-select [formControl]="form.controls.district" interface="popover" toggleIconSlot="end" toggleIcon="chevron-down-outline">
          <ion-select-option *ngFor="let d of districts" [value]="d">{{ d }}</ion-select-option>
        </ion-select>
      </ion-item>
      <ion-note color="danger" *ngIf="form.controls.district.touched && form.controls.district.invalid" class="field-error">District is required</ion-note>

      <ion-item>
        <ion-label position="stacked">City</ion-label>
        <ion-select [formControl]="form.controls.city" interface="popover" toggleIconSlot="end" toggleIcon="chevron-down-outline">
          <ion-select-option *ngFor="let c of cities()" [value]="c">{{ c }}</ion-select-option>
        </ion-select>
      </ion-item>
      <ion-note color="danger" *ngIf="form.controls.city.touched && form.controls.city.invalid" class="field-error">City is required</ion-note>

      <ion-item>
        <ion-label position="stacked">Hospital</ion-label>
        <ion-select [formControl]="form.controls.hospital" interface="popover" toggleIconSlot="end" toggleIcon="chevron-down-outline">
          <ion-select-option *ngFor="let h of hospitals()" [value]="h">{{ h }}</ion-select-option>
        </ion-select>
      </ion-item>
      <ion-note color="danger" *ngIf="form.controls.hospital.touched && form.controls.hospital.invalid" class="field-error">Hospital is required</ion-note>

      <ion-item>
        <ion-label position="stacked">Doctor</ion-label>
        <ion-select [formControl]="form.controls.doctor" interface="popover" toggleIconSlot="end" toggleIcon="chevron-down-outline">
          <ion-select-option *ngFor="let d of doctors()" [value]="d.name">{{ d.name }} â€” {{ d.specialisation }}</ion-select-option>
        </ion-select>
      </ion-item>
      <ion-note color="danger" *ngIf="form.controls.doctor.touched && form.controls.doctor.invalid" class="field-error">Doctor is required</ion-note>

      <ion-item button detail="false" (click)="openDatePicker()">
        <ion-label position="stacked">Date</ion-label>
        <ion-input readonly="true" [value]="form.controls.date.value ? (form.controls.date.value | date:'yyyy-MM-dd') : ''" placeholder="Select date"></ion-input>
      </ion-item>
      <ion-modal [isOpen]="dateModalOpen" [keepContentsMounted]="true" (willDismiss)="closeDatePicker()">
        <ng-template>
          <ion-datetime [min]="minDate" presentation="date" [value]="form.controls.date.value" (ionChange)="onDateChange($event)"></ion-datetime>
        </ng-template>
      </ion-modal>
      <ion-note color="danger" *ngIf="form.controls.date.touched && form.controls.date.invalid" class="field-error">Select a valid date (today or future)</ion-note>

      <ion-item>
        <ion-label position="stacked">Time Slot</ion-label>
        <ion-select [formControl]="form.controls.time" interface="popover" toggleIconSlot="end" toggleIcon="chevron-down-outline">
          <ion-select-option *ngFor="let t of timeSlots()" [value]="t">{{ fmt(t) }}</ion-select-option>
        </ion-select>
      </ion-item>
      <ion-note color="danger" *ngIf="form.controls.time.touched && form.controls.time.invalid" class="field-error">Select a time slot</ion-note>

      <ion-item>
        <ion-label position="stacked">Message (optional)</ion-label>
        <ion-textarea auto-grow="true" [formControl]="form.controls.message" placeholder="Reason for appointment"></ion-textarea>
      </ion-item>

      <div class="actions-row">
        <ion-button expand="block" (click)="submit()">Book Slot</ion-button>
      </div>
    </ion-list>
  </div>
</ion-content>
